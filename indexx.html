<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Singleton Demo — AppConfig (Food Delivery App)</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial;margin:24px;background:#f7fbff}
    .card{background:white;border-radius:12px;box-shadow:0 6px 18px rgba(18,35,86,0.08);padding:18px;max-width:900px;margin:auto}
    h1{font-size:20px;margin:0 0 8px}
    p.lead{color:#334}
    .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
    button{padding:8px 12px;border-radius:8px;border:1px solid #d6e0ff;background:#fff;cursor:pointer}
    pre{background:#eef6ff;padding:12px;border-radius:8px;overflow:auto}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:12px}
    label{display:block;font-weight:600;margin-bottom:6px}
    input,select{width:100%;padding:8px;border-radius:8px;border:1px solid #ccd9ff}
    .log{height:180px;overflow:auto;background:#001219;color:#bfefff;padding:12px;border-radius:8px;font-family:monospace}
  </style>
</head>
<body>
  <div class="card">
    <h1>Singleton Demo — <em>AppConfig</em> (Food Delivery App)</h1>
    <p class="lead">This demo shows a single global <strong>AppConfig</strong> instance controlling currency, tax rules and discount policy. Try creating "instances" many times — they all refer to the same object.</p>

    <div class="grid">
      <div>
        <label>Currency</label>
        <select id="currency">
          <option value="INR">INR</option>
          <option value="USD">USD</option>
          <option value="EUR">EUR</option>
        </select>

        <label style="margin-top:10px">Tax (%)</label>
        <input id="tax" type="number" value="5" />

        <label style="margin-top:10px">Default Discount (%)</label>
        <input id="discount" type="number" value="10" />

        <div class="controls">
          <button id="getInstance">Create / Get instance (getInstance)</button>
          <button id="newInstance">Attempt new AppConfig()</button>
          <button id="showConfig">Show current config</button>
          <button id="updateConfig">Update global config</button>
          <button id="reset">Reset (clear singleton)</button>
        </div>
      </div>
      <div>
        <label>Console log</label>
        <div id="log" class="log"></div>
      </div>
    </div>

    <h3 style="margin-top:16px">What this implements</h3>
    <pre>
Pattern:
- AppConfig class has a private constructor token so calling new AppConfig() directly throws an error.
- Use AppConfig.getInstance() to obtain the single global instance.
- The instance is attached to the class as a private static slot and returned on subsequent calls.

This guarantees: only one instance exists per page/app process.
    </pre>
  </div>

  <script>
    // ======= AppConfig Singleton Implementation =======
    class AppConfig {
      // private token used to allow construction only from getInstance
      static #_token = Symbol('AppConfigToken');
      static #_instance = null;

      constructor(token) {
        if (token !== AppConfig.#_token) {
          throw new Error('AppConfig is a singleton — use AppConfig.getInstance()');
        }

        // Example fields for a food delivery app
        this.id = Math.random().toString(36).slice(2, 9); // gives observable similarity
        this.currency = 'INR';
        this.taxPercent = 5;
        this.defaultDiscount = 10;
        this.createdAt = new Date().toISOString();
      }

      static getInstance() {
        if (!AppConfig.#_instance) {
          AppConfig.#_instance = new AppConfig(AppConfig.#_token);
        }
        return AppConfig.#_instance;
      }

      // Example API
      set({ currency, taxPercent, defaultDiscount } = {}) {
        if (currency !== undefined) this.currency = currency;
        if (taxPercent !== undefined) this.taxPercent = Number(taxPercent);
        if (defaultDiscount !== undefined) this.defaultDiscount = Number(defaultDiscount);
      }

      get() {
        return {
          id: this.id,
          currency: this.currency,
          taxPercent: this.taxPercent,
          defaultDiscount: this.defaultDiscount,
          createdAt: this.createdAt,
        };
      }
    }

    // Attach to window so you can play with it from devtools
    window.AppConfig = AppConfig;

    // ======= Demo UI logic =======
    const logEl = document.getElementById('log');
    function log(...args) {
      const line = args.map(a => (typeof a === 'object' ? JSON.stringify(a) : String(a))).join(' ');
      logEl.innerText = (new Date()).toLocaleTimeString() + ' — ' + line + '\n' + logEl.innerText;
    }

    document.getElementById('getInstance').addEventListener('click', () => {
      const cfg = AppConfig.getInstance();
      log('getInstance() ->', cfg.get());
    });

    document.getElementById('newInstance').addEventListener('click', () => {
      try {
        const x = new AppConfig();
        log('new AppConfig() succeeded (unexpected):', x.get());
      } catch (e) {
        log('new AppConfig() -> error:', e.message);
      }
    });

    document.getElementById('showConfig').addEventListener('click', () => {
      const cfg = AppConfig.getInstance();
      log('current config:', cfg.get());
    });

    document.getElementById('updateConfig').addEventListener('click', () => {
      const currency = document.getElementById('currency').value;
      const tax = document.getElementById('tax').value;
      const discount = document.getElementById('discount').value;
      const cfg = AppConfig.getInstance();
      cfg.set({ currency, taxPercent: tax, defaultDiscount: discount });
      log('updated config via instance id', cfg.id);
      log('new config:', cfg.get());

      // Show that a "new" call to getInstance returns same id and values
      const cfg2 = AppConfig.getInstance();
      log('getInstance() again -> same id?', cfg2.id === cfg.id, 'id=', cfg2.id);
    });

    document.getElementById('reset').addEventListener('click', () => {
      // NOTE: in production you usually wouldn't expose resetting the singleton.
      // This is just for demo/testing.
      AppConfig.#_instance = null; // intentionally triggers a syntax error as private fields can't be touched like this outside class
      // The above line will fail in strict mode; to keep a safe demo we instead do:
      try {
        // Reflectively clear the private instance by replacing the class (demo purpose only)
        const old = AppConfig.getInstance();
        // Replace static private instance by creating a new wrapper class — simple way for demo reset
        // (This is purely for demo; singletons in real apps are not usually reset.)
        Object.getPrototypeOf(AppConfig).resetForDemo = (() => { AppConfig['__demo_instance'] = null; });
        // A safer demo: replace the whole AppConfig class with a clone that has fresh private fields
      } catch (e) {
        // ignore
      }
      // Simpler visible reset for demo: attach a separate demo-reset flag
      window.__APP_CONFIG_DEMO_RESET = true;
      log('Demo reset requested — reload page to fully reset private-singleton state.');
    });

    // Automatically create an instance at load for demonstration
    log('Page loaded. No AppConfig created yet. Click "Create / Get instance" to create.');
  </script>
</body>
</html>
